<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººç§°ä»£åè© æ¼”ç¿’</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 10px 15px;
            background-color: #f9f9f9;
            color: #333;
        }
        h1 { 
            text-align: center; 
            margin-bottom: 15px; 
            font-size: 1.5rem;
        }
        
        /* --- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ --- */
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .level-group { display: flex; gap: 8px; }
        .level-btn {
            padding: 6px 16px;
            border: 1px solid #007bff;
            background-color: white;
            color: #007bff;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .level-btn:hover { background-color: #e6f2ff; }
        .level-btn.active { background-color: #007bff; color: white; }

        .mode-group { display: flex; gap: 15px; font-size: 0.95rem; align-items: center; }
        .mode-label { cursor: pointer; display: flex; align-items: center; gap: 5px; }
        input[type="radio"] { transform: scale(1.2); cursor: pointer; }

        /* --- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ --- */
        #messageArea {
            text-align: center;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            display: none;
        }
        .msg-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            animation: fadeIn 0.5s;
        }

        /* --- ãƒ†ãƒ¼ãƒ–ãƒ« --- */
        .table-container {
            overflow-x: auto;
            margin-bottom: 20px;
            -webkit-overflow-scrolling: touch;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 0.95rem;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px 8px;
            text-align: center;
            min-width: 60px;
        }
        th {
            background-color: #007bff;
            color: white;
            /* æ”¹è¡Œã‚³ãƒ¼ãƒ‰(\n)ã‚’åæ˜ ã•ã›ã‚‹è¨­å®šã€‚innerHTMLã‚’ä½¿ã‚ãšã«æ”¹è¡Œã§ãã¾ã™ */
            white-space: pre-line; 
            vertical-align: middle;
        }
        td.row-header {
            background-color: #e9ecef;
            font-weight: bold;
            width: 1%;
            white-space: nowrap;
            text-align: left;
            padding-left: 10px;
        }

        /* --- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  --- */
        input[type="text"] {
            width: 90%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            text-align: center;
            background-color: #fcfcfc;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #007bff;
            background-color: #fff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
        }

        /* --- æ­£èª¤åˆ¤å®šã‚¹ã‚¿ã‚¤ãƒ« --- */
        .correct-cell {
            background-color: #d4edda;
            color: #155724;
            font-weight: bold;
        }
        .incorrect-cell { background-color: #f8d7da; }
        .incorrect-cell input {
            border-color: #dc3545;
            color: #dc3545;
            background-color: #fff;
        }
        /* ãƒ’ãƒ³ãƒˆè¡¨ç¤ºç”¨ï¼ˆDOMç”Ÿæˆã§å¯¾å¿œã™ã‚‹ãŸã‚CSSã¯æœ€å°é™ï¼‰ */
        .answer-hint {
            font-size: 0.75em;
            color: #dc3545;
            margin-top: 2px;
            display: block;
        }

        /* --- ãƒœã‚¿ãƒ³ --- */
        .btn-container { text-align: center; margin-top: 20px; padding-bottom: 40px; }
        button.action-btn {
            padding: 12px 40px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            color: white;
            transition: background 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        #checkBtn { background-color: #28a745; }
        #checkBtn:hover { background-color: #218838; }
        #retryBtn { background-color: #007bff; }
        #retryBtn:hover { background-color: #0069d9; }
        .hidden { display: none; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- ã‚¹ãƒãƒ›ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– --- */
        @media (max-width: 600px) {
            body { padding: 5px; }
            h1 { font-size: 1.2rem; }
            .controls { gap: 10px; padding: 10px; }
            .level-btn { padding: 5px 12px; font-size: 0.8rem; }
            th, td { padding: 6px 2px; font-size: 0.85rem; }
            input[type="text"] { font-size: 0.9rem; padding: 4px; }
            th { font-size: 0.8rem; }
        }
    </style>
</head>
<body>

    <h1 id="pageTitle">äººç§°ä»£åè© æ¼”ç¿’</h1>

    <div class="controls">
        <div class="level-group">
            <button class="level-btn active" onclick="app.setDifficulty(1)">Level 1</button>
            <button class="level-btn" onclick="app.setDifficulty(2)">Level 2</button>
            <button class="level-btn" onclick="app.setDifficulty(3)">Level 3</button>
        </div>
        <div class="mode-group">
            <label class="mode-label">
                <input type="radio" name="mode" value="basic" checked onchange="app.changeMode()">
                åŸºæœ¬ (3åˆ—)
            </label>
            <label class="mode-label">
                <input type="radio" name="mode" value="full" onchange="app.changeMode()">
                ã™ã¹ã¦ (5åˆ—)
            </label>
        </div>
    </div>

    <div id="messageArea"></div>

    <div class="table-container">
        <table id="quizTable"></table>
    </div>

    <div class="btn-container">
        <button id="checkBtn" class="action-btn" onclick="app.checkAnswers()">ç­”ãˆåˆã‚ã›</button>
        <button id="retryBtn" class="action-btn hidden" onclick="app.resetQuiz()">ã‚‚ã†ä¸€å›</button>
    </div>

<script>
    /**
     * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«æ±šæŸ“ã‚’é˜²ã
     */
    const app = (function() {
        
        // --- è¨­å®šãƒ‡ãƒ¼ã‚¿ ---
        // æ”¹è¡Œã¯ \n ã§è¡¨ç¾ã—ã€CSSã® white-space: pre-line ã§åæ˜ ã•ã›ã‚‹
        const config = {
            title: "äººç§°ä»£åè© æ¼”ç¿’",
            allColHeaders: ["ä¸»æ ¼", "ç›®çš„æ ¼", "æ‰€æœ‰å½¢å®¹è©\n(æ‰€æœ‰æ ¼)", "æ‰€æœ‰ä»£åè©", "å†å¸°ä»£åè©"],
            rowHeaders: [
                "1äººç§° å˜æ•°", "2äººç§° å˜æ•°", "3äººç§° å˜æ•°(ç”·æ€§)", "3äººç§° å˜æ•°(å¥³æ€§)", "3äººç§° å˜æ•°(ç‰©)",
                "1äººç§° è¤‡æ•°", "2äººç§° è¤‡æ•°", "3äººç§° è¤‡æ•°"
            ],
            allData: [
                ["I",    "me",   "my",    "mine",   "myself"],
                ["you",  "you",  "your",  "yours",  "yourself"],
                ["he",   "him",  "his",   "his",    "himself"],
                ["she",  "her",  "her",   "hers",   "herself"],
                ["it",   "it",   "its",   "-",      "itself"],
                ["we",   "us",   "our",   "ours",   "ourselves"],
                ["you",  "you",  "your",  "yours",  "yourselves"],
                ["they", "them", "their", "theirs", "themselves"]
            ]
        };

        const difficultyRates = {
            1: 0.15, // å°‘ã—ä¸Šã’ã‚‹(è©°ã¿é˜²æ­¢ãƒ­ã‚¸ãƒƒã‚¯ãŒå…¥ã‚‹ãŸã‚)
            2: 0.35, 
            3: 0.60  
        };

        let currentLevel = 2;
        let currentMode = 'basic'; 

        // --- DOMè¦ç´ å–å¾—ãƒ˜ãƒ«ãƒ‘ãƒ¼ ---
        const getEl = (id) => document.getElementById(id);

        function init() {
            getEl('pageTitle').textContent = config.title;
            resetQuiz();
        }

        function setDifficulty(level) {
            currentLevel = level;
            document.querySelectorAll('.level-btn').forEach((btn, index) => {
                if (index + 1 === level) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            resetQuiz();
        }

        function changeMode() {
            const radios = document.getElementsByName('mode');
            for (const radio of radios) {
                if (radio.checked) {
                    currentMode = radio.value;
                    break;
                }
            }
            resetQuiz();
        }

        function resetQuiz() {
            // UIãƒªã‚»ãƒƒãƒˆ
            const msgArea = getEl('messageArea');
            msgArea.style.display = 'none';
            msgArea.className = '';
            msgArea.textContent = '';
            
            getEl('checkBtn').classList.remove('hidden');
            getEl('retryBtn').classList.add('hidden');

            const table = getEl('quizTable');
            // innerHTML="" ã¯å­è¦ç´ å‰Šé™¤ã®é«˜é€Ÿãªæ‰‹æ®µã¨ã—ã¦è¨±å®¹ã•ã‚Œã‚‹ãŒã€
            // å¿µã®ãŸã‚ãƒ«ãƒ¼ãƒ—å‰Šé™¤ã«ã™ã‚‹ãªã‚‰ while(table.firstChild) table.removeChild(table.firstChild);
            table.textContent = ''; 

            const colCount = (currentMode === 'basic') ? 3 : 5;
            
            // --- ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆ (document.createElementä½¿ç”¨) ---
            const thead = document.createElement('tr');
            thead.appendChild(document.createElement('th')); // å·¦ä¸Š
            
            for (let i = 0; i < colCount; i++) {
                const th = document.createElement('th');
                th.textContent = config.allColHeaders[i]; // HTMLã‚¿ã‚°ã¯è§£é‡ˆã•ã‚Œãªã„(å®‰å…¨)
                thead.appendChild(th);
            }
            table.appendChild(thead);

            // --- ãƒ‡ãƒ¼ã‚¿è¡Œç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ ---
            const rate = difficultyRates[currentLevel];
            let tableRows = [];
            let totalBlanks = 0;
            let attempts = 0;

            do {
                tableRows = [];
                totalBlanks = 0;
                attempts++;

                config.allData.forEach((fullRowData, rIndex) => {
                    let rowCells = [];
                    let rowBlankCount = 0;

                    for (let cIndex = 0; cIndex < colCount; cIndex++) {
                        const cellData = fullRowData[cIndex];
                        let isBlank = false;
                        
                        if (cellData !== "-") {
                            // å°†æ¥çš„ã«ã€Œæ‰€æœ‰æ ¼ã ã‘ç©´åŸ‹ã‚ã€ç­‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ãªã‚‰ã“ã“ã§åˆ¤å®š
                            if (Math.random() < rate) {
                                isBlank = true;
                                rowBlankCount++;
                                totalBlanks++;
                            }
                        }
                        rowCells.push({
                            text: cellData,
                            isBlank: isBlank,
                            r: rIndex,
                            c: cIndex
                        });
                    }

                    // --- [æ”¹å–„ãƒ­ã‚¸ãƒƒã‚¯] ---
                    // è¡Œã™ã¹ã¦ãŒç©ºæ¬„(rowBlankCount === colCount)ã«ãªã£ã¦ã—ã¾ã£ãŸå ´åˆã€
                    // ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤ã ã‘ç©ºæ¬„ã‚’è§£é™¤ã™ã‚‹ï¼ˆãƒ’ãƒ³ãƒˆã‚’æ®‹ã™ï¼‰
                    if (rowBlankCount === colCount && colCount > 0) {
                         // ç©ºæ¬„ã«ãªã£ã¦ã„ã‚‹ã‚»ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¢ã™
                         const blankIndices = rowCells
                            .map((cell, idx) => cell.isBlank ? idx : -1)
                            .filter(idx => idx !== -1);
                         
                         if (blankIndices.length > 0) {
                             // ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤é¸ã‚“ã§å¯è¦–åŒ–
                             const rescueIndex = blankIndices[Math.floor(Math.random() * blankIndices.length)];
                             rowCells[rescueIndex].isBlank = false;
                             totalBlanks--; 
                         }
                    }

                    tableRows.push(rowCells);
                });
                
            } while (totalBlanks < 2 && attempts < 100);

            // --- DOMæç”» (innerHTMLä¸ä½¿ç”¨) ---
            tableRows.forEach((rowCells, rIndex) => {
                const tr = document.createElement('tr');
                
                const rowHead = document.createElement('td');
                rowHead.classList.add('row-header');
                rowHead.textContent = config.rowHeaders[rIndex];
                tr.appendChild(rowHead);

                rowCells.forEach(cell => {
                    const td = document.createElement('td');
                    
                    if (cell.text === "-") {
                        td.textContent = "-";
                    } else if (cell.isBlank) {
                        const input = document.createElement('input');
                        input.type = "text";
                        input.dataset.r = cell.r;
                        input.dataset.c = cell.c;
                        input.autocomplete = "off";
                        td.appendChild(input);
                    } else {
                        td.textContent = cell.text;
                    }
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });

            // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹åˆ¶å¾¡
            const firstInput = table.querySelector('input[type="text"]');
            if (firstInput && window.innerWidth > 600) { 
                firstInput.focus(); 
            }
        }

        function checkAnswers() {
            const inputs = document.querySelectorAll('input[type="text"]');
            let correctCount = 0;
            let totalCount = inputs.length;

            if (totalCount === 0) return;

            inputs.forEach(input => {
                const r = input.dataset.r;
                const c = input.dataset.c;
                const correctVal = config.allData[r][c];
                const userVal = input.value.trim();
                const parentTd = input.parentElement;

                input.disabled = true;

                // innerHTMLã‚’ä½¿ã‚ãšã€ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰æ“ä½œã§æ›´æ–°
                if (userVal.toLowerCase() === correctVal.toLowerCase()) {
                    parentTd.textContent = correctVal; 
                    parentTd.classList.add('correct-cell');
                    correctCount++;
                } else {
                    parentTd.classList.add('incorrect-cell');
                    // ãƒ’ãƒ³ãƒˆè¦ç´ ã‚‚createElementã§ä½œã‚‹
                    const hint = document.createElement('div');
                    hint.classList.add('answer-hint');
                    hint.textContent = `(${correctVal})`;
                    parentTd.appendChild(hint);
                }
            });

            getEl('checkBtn').classList.add('hidden');
            getEl('retryBtn').classList.remove('hidden');

            if (correctCount === totalCount) {
                const msgArea = getEl('messageArea');
                msgArea.textContent = "ğŸ‰ Perfect!! å…¨å•æ­£è§£ã§ã™ï¼ ğŸ‰";
                msgArea.className = 'msg-success';
                msgArea.style.display = 'block';
            }
        }

        // å¤–éƒ¨ã‹ã‚‰å‘¼ã¹ã‚‹é–¢æ•°ã‚’å…¬é–‹
        return {
            init,
            setDifficulty,
            changeMode,
            resetQuiz,
            checkAnswers
        };

    })();

    // èµ·å‹•
    app.init();
</script>

</body>
</html>
